<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>ALLO85 ‚Äì Mini App Telegram Premium</title>

<style>
/* =====================================================
   VARIABLES & BASE
===================================================== */
:root {
  --bg-main: #0b0f14;
  --bg-grad-1: #0e1117;
  --bg-grad-2: #0a0d12;
  --card: #161b22;
  --card-soft: #1c222b;
  --accent: #3b82f6;
  --accent-soft: #1f6feb;
  --success: #2ea043;
  --error: #f85149;
  --warning: #d29922;
  --text-main: #e6edf3;
  --text-muted: #8b949e;
  --radius: 16px;
  --radius-sm: 10px;
  --shadow: 0 10px 30px rgba(0,0,0,.45);
  --speed-fast: .2s;
  --speed: .35s;
  --speed-slow: .6s;
}

/* =====================================================
   RESET
===================================================== */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont,
    "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell,
    "Helvetica Neue", sans-serif;
}

body {
  background: linear-gradient(180deg,var(--bg-grad-1),var(--bg-grad-2));
  color: var(--text-main);
  min-height: 100vh;
  overflow-x: hidden;
}

/* =====================================================
   APP LAYOUT
===================================================== */
.app {
  max-width: 540px;
  margin: 0 auto;
  padding: 20px 16px 40px;
}

header.app-header {
  text-align: center;
  margin-bottom: 24px;
}

header.app-header h1 {
  font-size: 30px;
  letter-spacing: 1px;
  margin-bottom: 6px;
}

header.app-header p {
  font-size: 14px;
  color: var(--text-muted);
}

/* =====================================================
   SCREENS & ROUTER
===================================================== */
.screen {
  display: none;
  animation: fadeIn var(--speed) ease;
}

.screen.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity:0; transform:translateY(12px); }
  to   { opacity:1; transform:translateY(0); }
}

/* =====================================================
   CARDS & UI
===================================================== */
.card {
  background: var(--card);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 18px;
  box-shadow: var(--shadow);
}

.card.soft {
  background: var(--card-soft);
}

.card h2 {
  font-size: 20px;
  margin-bottom: 12px;
}

.card p {
  font-size: 14px;
  color: var(--text-muted);
  line-height: 1.45;
}

/* =====================================================
   BUTTONS
===================================================== */
button {
  border: none;
  border-radius: var(--radius);
  padding: 14px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--speed-fast);
}

button.primary {
  background: linear-gradient(135deg,var(--accent),var(--accent-soft));
  color: #fff;
}

button.secondary {
  background: #21262d;
  color: var(--text-main);
}

button.danger {
  background: #21262d;
  color: var(--error);
}

button.small {
  padding: 10px;
  font-size: 13px;
}

button:active {
  transform: scale(.97);
}

button:disabled {
  opacity: .5;
  cursor: not-allowed;
}

/* =====================================================
   ACTIONS / STACKS
===================================================== */
.actions {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 16px;
}

.row {
  display: flex;
  gap: 10px;
}

/* =====================================================
   FORM ELEMENTS
===================================================== */
input, textarea, select {
  width: 100%;
  background: #0d1117;
  border: 1px solid #30363d;
  border-radius: var(--radius-sm);
  padding: 12px;
  font-size: 14px;
  color: #fff;
  margin-top: 10px;
}

textarea { resize: vertical; }

/* =====================================================
   BADGES / STATUS
===================================================== */
.badge {
  display: inline-block;
  padding: 6px 10px;
  border-radius: 20px;
  font-size: 12px;
  background: #21262d;
  color: var(--text-muted);
}

.status {
  text-align: center;
  margin-top: 14px;
  font-size: 14px;
}

.status.success { color: var(--success); }
.status.error { color: var(--error); }
.status.warning { color: var(--warning); }

/* =====================================================
   NAV FOOTER
===================================================== */
.footer {
  text-align: center;
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 28px;
}

/* =====================================================
   LISTS
===================================================== */
.list {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 12px;
}

.list-item {
  background: #0d1117;
  border-radius: var(--radius-sm);
  padding: 12px;
  font-size: 14px;
  cursor: pointer;
  transition: background var(--speed-fast);
}

.list-item:hover {
  background: #161b22;
}

/* =====================================================
   LOADER
===================================================== */
.loader {
  width: 32px;
  height: 32px;
  border: 3px solid #30363d;
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
</head>

<body>
<div class="app">

<header class="app-header">
  <h1>ALLO85</h1>
  <p>Mini-application Telegram professionnelle</p>
</header>

<!-- SPLASH -->
<section id="screen-splash" class="screen active">
  <div class="card">
    <h2>Bienvenue</h2>
    <p>Acc√®de √† l‚Äôinterface ALLO85 et d√©clenche tes actions en quelques secondes.</p>
    <div class="actions">
      <button class="primary" onclick="Router.go('home')">Entrer</button>
    </div>
  </div>
</section>

<!-- HOME -->
<section id="screen-home" class="screen">
  <div class="card">
    <h2>Dashboard</h2>
    <p>S√©lectionne une action.</p>
    <div class="actions">
      <button class="primary" onclick="Actions.start('urgence')">üö® Demande urgente</button>
      <button class="primary" onclick="Actions.start('commande')">üì¶ Commande</button>
      <button class="primary" onclick="Actions.start('info')">‚ÑπÔ∏è Information</button>
      <button class="secondary" onclick="Router.go('history')">üìú Historique</button>
      <button class="secondary" onclick="Router.go('settings')">‚öôÔ∏è Param√®tres</button>
      <button class="secondary" onclick="Router.go('about')">√Ä propos</button>
    </div>
  </div>
</section>

<!-- FORM -->
<section id="screen-form" class="screen">
  <div class="card">
    <h2 id="form-title"></h2>
    <p>Renseigne les informations.</p>

    <input id="input-name" placeholder="Nom">
    <textarea id="input-message" rows="4" placeholder="Message / D√©tails"></textarea>

    <div class="actions">
      <button class="primary" onclick="Flow.confirm()">Continuer</button>
      <button class="secondary" onclick="Router.go('home')">Annuler</button>
    </div>
  </div>
</section>

<!-- CONFIRM -->
<section id="screen-confirm" class="screen">
  <div class="card">
    <h2>Confirmation</h2>
    <div class="badge" id="confirm-preview"></div>
    <div class="actions">
      <button class="primary" onclick="Flow.send()">Envoyer</button>
      <button class="secondary" onclick="Router.go('form')">Modifier</button>
    </div>
  </div>
</section>

<!-- RESULT -->
<section id="screen-result" class="screen">
  <div class="card">
    <h2 id="result-title"></h2>
    <p id="result-text"></p>
    <div class="actions">
      <button class="primary" onclick="Router.go('home')">Retour accueil</button>
    </div>
  </div>
</section>

<!-- HISTORY -->
<section id="screen-history" class="screen">
  <div class="card">
    <h2>Historique</h2>
    <div id="history-list" class="list"></div>
    <div class="actions">
      <button class="secondary" onclick="Router.go('home')">Retour</button>
    </div>
  </div>
</section>

<!-- SETTINGS -->
<section id="screen-settings" class="screen">
  <div class="card">
    <h2>Param√®tres</h2>
    <p>Pr√©f√©rences locales.</p>
    <div class="actions">
      <button class="danger" onclick="Settings.clear()">Effacer historique</button>
      <button class="secondary" onclick="Router.go('home')">Retour</button>
    </div>
  </div>
</section>

<!-- ABOUT -->
<section id="screen-about" class="screen">
  <div class="card">
    <h2>√Ä propos</h2>
    <p>
      ALLO85 est une mini-app Telegram autonome, con√ßue pour √™tre rapide,
      fiable et √©volutive. Toutes les donn√©es sont stock√©es localement
      et envoy√©es via Telegram WebApp.
    </p>
    <div class="actions">
      <button class="secondary" onclick="Router.go('home')">Retour</button>
    </div>
  </div>
</section>

<div class="footer">
  ¬© ALLO85 ‚Äì Telegram WebApp
</div>

</div>
<script>
/* =====================================================
   TELEGRAM INIT
===================================================== */
const TelegramApp = window.Telegram ? window.Telegram.WebApp : null;
if (TelegramApp) {
  TelegramApp.ready();
  TelegramApp.expand();
}

/* =====================================================
   STATE MANAGER
===================================================== */
const Store = {
  state: {
    action: null,
    name: "",
    message: "",
    loading: false,
    offline: false
  },
  set(key, value) {
    this.state[key] = value;
  },
  get(key) {
    return this.state[key];
  },
  reset() {
    this.state = {
      action: null,
      name: "",
      message: "",
      loading: false,
      offline: false
    };
  }
};

/* =====================================================
   ROUTER SPA
===================================================== */
const Router = {
  current: null,
  go(screen) {
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    const target = document.getElementById("screen-" + screen);
    if (target) {
      target.classList.add("active");
      this.current = screen;
      if (screen === "history") History.render();
    }
  }
};

/* =====================================================
   ACTIONS
===================================================== */
const Actions = {
  start(type) {
    Store.set("action", type);
    document.getElementById("form-title").innerText =
      type === "urgence" ? "Demande urgente" :
      type === "commande" ? "Commande" : "Information";
    Router.go("form");
  }
};

/* =====================================================
   FLOW LOGIC
===================================================== */
const Flow = {
  confirm() {
    const name = document.getElementById("input-name").value.trim();
    const message = document.getElementById("input-message").value.trim();

    if (!name || !message) {
      alert("Tous les champs sont obligatoires");
      return;
    }

    Store.set("name", name);
    Store.set("message", message);

    document.getElementById("confirm-preview").innerText =
      `Action : ${Store.get("action")}
Nom : ${name}
Message : ${message}`;

    Router.go("confirm");
  },

  send() {
    if (Store.get("loading")) return;

    Store.set("loading", true);

    const payload = {
      app: "ALLO85",
      action: Store.get("action"),
      name: Store.get("name"),
      message: Store.get("message"),
      timestamp: Date.now()
    };

    try {
      if (TelegramApp) {
        TelegramApp.sendData(JSON.stringify(payload));
      } else {
        Store.set("offline", true);
      }

      History.save(payload);
      UI.showResult(true);
    } catch (e) {
      UI.showResult(false);
    }

    Store.set("loading", false);
  }
};

/* =====================================================
   UI FEEDBACK
===================================================== */
const UI = {
  showResult(success) {
    document.getElementById("result-title").innerText =
      success ? "Succ√®s" : "Erreur";
    document.getElementById("result-text").innerText =
      success
        ? "Action envoy√©e et enregistr√©e."
        : "Une erreur est survenue lors de l‚Äôenvoi.";
    Router.go("result");
  }
};

/* =====================================================
   HISTORY MANAGER
===================================================== */
const History = {
  key: "allo85_history",

  load() {
    return JSON.parse(localStorage.getItem(this.key) || "[]");
  },

  save(entry) {
    const history = this.load();
    history.unshift(entry);
    localStorage.setItem(this.key, JSON.stringify(history));
  },

  clear() {
    localStorage.removeItem(this.key);
    alert("Historique effac√©");
  },

  render() {
    const list = document.getElementById("history-list");
    const history = this.load();
    list.innerHTML = "";

    if (!history.length) {
      list.innerHTML = "<p>Aucune action enregistr√©e.</p>";
      return;
    }

    history.forEach(item => {
      const el = document.createElement("div");
      el.className = "list-item";
      el.innerText =
        `${new Date(item.timestamp).toLocaleString()}
${item.action} ‚Äì ${item.name}`;
      list.appendChild(el);
    });
  }
};

/* =====================================================
   SETTINGS
===================================================== */
const Settings = {
  clear() {
    if (confirm("Effacer tout l‚Äôhistorique ?")) {
      History.clear();
    }
  }
};

/* =====================================================
   OFFLINE SIMULATION
===================================================== */
window.addEventListener("offline", () => {
  Store.set("offline", true);
});
window.addEventListener("online", () => {
  Store.set("offline", false);
});

/* =====================================================
   BOOT
===================================================== */
Router.go("splash");
</script>
</body>
</html>
