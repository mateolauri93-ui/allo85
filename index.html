<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>ALLO ‚Äî Premium Experience</title>

<style>
/* =====================================================
   THEME GLOBAL
===================================================== */
:root{
  --bg-main:#0b0f14;
  --bg-dark:#07090d;
  --card:#161b22;
  --card-soft:#1c222b;

  --gold:#c9a24d;
  --gold-soft:#f5d57a;

  --yellow:#facc15;
  --orange:#fb923c;
  --blue:#60a5fa;

  --text:#e6edf3;
  --muted:#8b949e;

  --radius:18px;
  --shadow:0 14px 40px rgba(0,0,0,.45);
}

/* =====================================================
   RESET
===================================================== */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu;
  background:linear-gradient(180deg,var(--bg-main),var(--bg-dark));
  color:var(--text);
}

/* =====================================================
   LAYOUT
===================================================== */
.app{
  max-width:560px;
  margin:auto;
  min-height:100%;
  padding:14px;
}

/* =====================================================
   SCREENS
===================================================== */
.screen{display:none}
.screen.active{display:block}

/* =====================================================
   UI
===================================================== */
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:18px;
  margin-bottom:14px;
  box-shadow:var(--shadow);
}
.card.soft{background:var(--card-soft)}

.stack{display:flex;flex-direction:column;gap:12px}

button{
  border:none;
  border-radius:14px;
  padding:14px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  position:relative;
  overflow:hidden;
}

.primary{
  background:linear-gradient(135deg,var(--gold),var(--gold-soft));
  color:#000;
}
.secondary{
  background:#21262d;
  color:var(--text);
}

/* =====================================================
   UX FEEDBACK
===================================================== */
button.loading{
  opacity:.7;
  pointer-events:none;
}
button.loading::after{
  content:"";
  width:22px;
  height:22px;
  border:3px solid rgba(255,255,255,.4);
  border-top-color:#fff;
  border-radius:50%;
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  animation:spin .8s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg) translate(-50%,-50%)}}

button.success{
  background:linear-gradient(135deg,#22c55e,#16a34a);
  color:#000;
}

.feedback{
  font-size:13px;
  text-align:center;
  color:var(--muted);
  min-height:18px;
  opacity:0;
  transition:opacity .3s;
}
.feedback.visible{opacity:1}

/* =====================================================
   MODAL
===================================================== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal.active{display:flex}
.modal-content{
  background:var(--card);
  border-radius:var(--radius);
  padding:18px;
  width:92%;
  max-width:420px;
}
</style>

   </head>

<body>
<div class="app">

<!-- =========================
     LANDING
========================= -->
<section id="landing" class="screen active">
  <div class="card">
    <h1 style="text-align:center;font-size:42px;letter-spacing:3px">ALLO</h1>
    <p style="text-align:center;color:var(--muted);margin:12px 0 24px">
      Exp√©rience premium, rapide et ma√Ætris√©e
    </p>
    <button class="primary" onclick="enterApp()" style="width:100%">
      Entrer dans l‚Äôexp√©rience
    </button>
  </div>
</section>

<!-- =========================
     APP SHELL
========================= -->
<div id="app-shell" style="display:none">

  <!-- =========================
       NAVIGATION
  ========================= -->
  <div class="card">
    <div class="stack">
      <button class="secondary" onclick="go('dashboard')">üè† Accueil</button>
      <button class="secondary" onclick="go('cart')">üõí Panier</button>
      <button class="secondary" onclick="go('history')">üìú Historique</button>
    </div>
  </div>

  <!-- =========================
       DASHBOARD
  ========================= -->
  <section id="dashboard" class="screen">
    <div class="card">
      <h2>Catalogue</h2>
      <div class="stack">
        <button class="primary" onclick="go('jaune')">üü° Jaune</button>
        <button class="secondary" onclick="go('filtrer')">üî• Filtrer</button>
        <button class="secondary" onclick="go('frozen')">‚ùÑÔ∏è Frozen</button>
      </div>
    </div>
  </section>

  <!-- =========================
       PRODUITS
  ========================= -->
  <section id="jaune" class="screen"></section>
  <section id="filtrer" class="screen"></section>
  <section id="frozen" class="screen"></section>

  <!-- =========================
       PANIER
  ========================= -->
  <section id="cart" class="screen">
    <div class="card">
      <h2>üõí Panier</h2>
      <div id="cart-list"></div>
      <div class="stack">
        <button class="primary" onclick="openConfirm()">Confirmer la commande</button>
      </div>
    </div>
  </section>

  <!-- =========================
       HISTORIQUE
  ========================= -->
  <section id="history" class="screen">
    <div class="card">
      <h2>üìú Historique</h2>
      <div id="history-list"></div>
    </div>
  </section>

  <!-- =========================
       MODAL CONFIRMATION
  ========================= -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <h2>Confirmation</h2>
      <div id="confirm-content" style="margin:12px 0"></div>

      <div class="stack">
        <button class="primary" onclick="copyOrderToClipboardUX(this)">
          üìã Copier la commande
        </button>

        <button class="secondary" onclick="sendOrderViaTelegramUX(this)">
          üì© Envoyer sur Telegram
        </button>

        <div id="ux-feedback" class="feedback"></div>

        <button class="secondary" onclick="closeModal()">
          Annuler
        </button>
      </div>
    </div>
  </div>

</div>
<script>
/* =====================================================
   NAVIGATION
===================================================== */
function go(id){
  document.querySelectorAll(".screen").forEach(function(screen){
    screen.classList.remove("active");
  });
  const target = document.getElementById(id);
  if(target){
    target.classList.add("active");
  }
  if(id === "cart"){ renderCart(); }
  if(id === "history"){ renderHistory(); }
}

function enterApp(){
  document.getElementById("landing").classList.remove("active");
  document.getElementById("app-shell").style.display = "block";
  go("dashboard");
}

/* =====================================================
   PRODUITS
===================================================== */
const PRODUCTS = {
  jaune: [
    { price: 10, qty: "2g" },
    { price: 20, qty: "4g" },
    { price: 50, qty: "10g" }
  ],
  filtrer: [
    { price: 20, qty: "2g" },
    { price: 70, qty: "10g" }
  ],
  frozen: [
    { price: 30, qty: "3g" },
    { price: 90, qty: "10g" }
  ]
};

/* =====================================================
   STATE
===================================================== */
let cart = JSON.parse(localStorage.getItem("cart") || "[]");
let orders = JSON.parse(localStorage.getItem("orders") || "[]");

/* =====================================================
   CATALOGUES
===================================================== */
function renderCatalogue(id, key, title){
  const el = document.getElementById(id);
  let html = `<div class="card"><h2>${title}</h2><div class="stack">`;

  PRODUCTS[key].forEach(function(product){
    html += `
      <div class="card soft">
        <strong>${product.qty}</strong> ‚Äî ${product.price}‚Ç¨
        <button class="secondary" style="margin-top:8px"
          onclick="addToCart('${key}','${product.qty}',${product.price})">
          Ajouter
        </button>
      </div>
    `;
  });

  html += `<button class="secondary" onclick="go('dashboard')">Retour</button>`;
  html += `</div></div>`;
  el.innerHTML = html;
}

renderCatalogue("jaune","jaune","üü° Jaune");
renderCatalogue("filtrer","filtrer","üî• Filtrer");
renderCatalogue("frozen","frozen","‚ùÑÔ∏è Frozen");

/* =====================================================
   PANIER
===================================================== */
function addToCart(range, qty, price){
  const found = cart.find(function(item){
    return item.range === range && item.qty === qty;
  });

  if(found){
    found.count += 1;
  }else{
    cart.push({
      range: range,
      qty: qty,
      price: price,
      count: 1
    });
  }

  localStorage.setItem("cart", JSON.stringify(cart));
}

function renderCart(){
  const box = document.getElementById("cart-list");
  if(cart.length === 0){
    box.innerHTML = "<p>Panier vide.</p>";
    return;
  }

  let html = "";
  cart.forEach(function(item, index){
    html += `
      <div class="card soft">
        ${item.qty} (${item.range}) √ó ${item.count}<br>
        <strong>${item.price * item.count}‚Ç¨</strong><br>
        <button class="secondary" onclick="changeQty(${index},-1)">‚àí</button>
        <button class="secondary" onclick="changeQty(${index},1)">+</button>
      </div>
    `;
  });

  box.innerHTML = html;
}

function changeQty(index, delta){
  cart[index].count += delta;
  if(cart[index].count <= 0){
    cart.splice(index,1);
  }
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

/* =====================================================
   CONFIRMATION
===================================================== */
function openConfirm(){
  if(cart.length === 0){ return; }

  let html = "";
  cart.forEach(function(item){
    html += `${item.qty} √ó ${item.count} ‚Äî ${item.price * item.count}‚Ç¨<br>`;
  });

  document.getElementById("confirm-content").innerHTML = html;
  document.getElementById("modal").classList.add("active");
}

function closeModal(){
  document.getElementById("modal").classList.remove("active");
}

/* =====================================================
   G√âN√âRATION DU MESSAGE DE COMMANDE
===================================================== */
function generateOrderText(){
  if(cart.length === 0){ return ""; }

  let total = 0;
  let text = "üßæ COMMANDE ALLO\n\n";

  cart.forEach(function(item){
    const lineTotal = item.price * item.count;
    total += lineTotal;
    text += `‚Ä¢ ${item.qty} (${item.range}) √ó ${item.count} ‚Äî ${lineTotal}‚Ç¨\n`;
  });

  text += `\nüí∞ Total : ${total}‚Ç¨`;
  text += `\n‚è∞ ${new Date().toLocaleString()}`;

  return text;
}

/* =====================================================
   HISTORIQUE
===================================================== */
function renderHistory(){
  const box = document.getElementById("history-list");
  if(orders.length === 0){
    box.innerHTML = "<p>Aucune commande.</p>";
    return;
  }

  let html = "";
  orders.forEach(function(order){
    html += `
      <div class="card soft">
        ${order.text.replace(/\n/g,"<br>")}
      </div>
    `;
  });

  box.innerHTML = html;
}
</script>

<script>
/* =====================================================
   UX ‚Äî FEEDBACK UTILISATEUR (SANS BOT)
===================================================== */

/* =====================================================
   HAPTIC FEEDBACK (SI DANS TELEGRAM)
===================================================== */
function hapticLight(){
  if (window.Telegram &&
      Telegram.WebApp &&
      Telegram.WebApp.HapticFeedback){
    Telegram.WebApp.HapticFeedback.impactOccurred("light");
  }
}

/* =====================================================
   √âTATS DES BOUTONS
===================================================== */
function setButtonLoading(button, text){
  button.dataset.originalText = button.innerHTML;
  button.innerHTML = text;
  button.classList.add("loading");
}

function setButtonSuccess(button, text){
  button.classList.remove("loading");
  button.classList.add("success");
  button.innerHTML = text;
}

function resetButton(button){
  button.classList.remove("loading");
  button.classList.remove("success");
  if(button.dataset.originalText){
    button.innerHTML = button.dataset.originalText;
  }
}

/* =====================================================
   FEEDBACK TEXTE
===================================================== */
function showFeedback(message){
  const feedback = document.getElementById("ux-feedback");
  if(!feedback){ return; }

  feedback.innerText = message;
  feedback.classList.add("visible");

  setTimeout(function(){
    feedback.classList.remove("visible");
  }, 2000);
}

/* =====================================================
   COPIER LA COMMANDE ‚Äî UX
===================================================== */
function copyOrderToClipboardUX(button){
  hapticLight();
  setButtonLoading(button, "Copie en cours‚Ä¶");

  const text = generateOrderText();
  if(text === ""){
    resetButton(button);
    alert("Aucune commande √† copier.");
    return;
  }

  navigator.clipboard.writeText(text)
    .then(function(){
      setButtonSuccess(button, "‚úÖ Commande copi√©e");
      showFeedback("Commande copi√©e dans le presse-papiers üìã");
      setTimeout(function(){
        resetButton(button);
      }, 1800);
    })
    .catch(function(){
      resetButton(button);
      alert("Impossible de copier la commande.");
    });
}

/* =====================================================
   ENVOI VERS UN UTILISATEUR TELEGRAM PR√âCIS ‚Äî UX
===================================================== */
function sendOrderViaTelegramUX(button){
  hapticLight();
  setButtonLoading(button, "Ouverture de Telegram‚Ä¶");

  const text = generateOrderText();
  if(text === ""){
    resetButton(button);
    alert("Aucune commande √† envoyer.");
    return;
  }

  /* ===============================
     DESTINATAIRE TELEGRAM
     ‚ö†Ô∏è SANS LE @
  =============================== */
  const TELEGRAM_USERNAME = "allo856";

  const url =
    "https://t.me/" +
    TELEGRAM_USERNAME +
    "?text=" +
    encodeURIComponent(text);

  setTimeout(function(){
    resetButton(button);
    window.location.href = url;
  }, 700);
}

/* =====================================================
   S√âCURIT√â GLOBALE
===================================================== */
window.addEventListener("error", function(event){
  console.error("ALLO ERROR:", event.message);
});
</script>

</body>
</html>
