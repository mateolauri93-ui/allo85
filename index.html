<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>ALLO ‚Äî Premium Experience</title>

<style>
/* =====================================================
   THEME GLOBAL ‚Äî FINAL (IDENTIQUE)
===================================================== */
:root{
  --bg-main:#0b0f14;
  --bg-dark:#07090d;
  --card:#161b22;
  --card-soft:#1c222b;

  --gold:#c9a24d;
  --gold-soft:#f5d57a;

  --yellow:#facc15;
  --orange:#fb923c;
  --blue:#60a5fa;

  --text:#e6edf3;
  --muted:#8b949e;

  --radius:18px;
  --shadow:0 14px 40px rgba(0,0,0,.45);
}

/* =====================================================
   RESET
===================================================== */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu;
  background:linear-gradient(180deg,var(--bg-main),var(--bg-dark));
  color:var(--text);
}

/* =====================================================
   APP WRAPPER
===================================================== */
.app{
  max-width:560px;
  margin:auto;
  min-height:100%;
  padding:14px 14px 44px;
}

/* =====================================================
   SCREENS
===================================================== */
.screen{display:none}
.screen.active{display:block}

/* =====================================================
   UI
===================================================== */
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:18px;
  margin-bottom:14px;
  box-shadow:var(--shadow);
}
.card.soft{background:var(--card-soft)}

.stack{display:flex;flex-direction:column;gap:12px}

button{
  border:none;
  border-radius:14px;
  padding:14px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  transition:transform .15s ease, opacity .15s ease;
}

button:active{
  transform:scale(0.97);
}

.primary{
  background:linear-gradient(135deg,var(--gold),var(--gold-soft));
  color:#000;
}
.secondary{
  background:#21262d;
  color:var(--text);
}

/* =====================================================
   FEEDBACK DISCRET (AJOUT SANS CHANGER L‚ÄôUI)
===================================================== */
button.loading{
  opacity:0.6;
  pointer-events:none;
}
button.success{
  background:linear-gradient(135deg,#22c55e,#16a34a)!important;
  color:#000;
}

/* =====================================================
   MODAL
===================================================== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal.active{display:flex}
.modal-content{
  background:var(--card);
  border-radius:var(--radius);
  padding:18px;
  width:92%;
  max-width:420px;
}
</style>
</head>

<body>
<div class="app">

<!-- =========================
     LANDING (PAGE D‚ÄôACCUEIL)
========================= -->
<section id="landing" class="screen active">
  <div class="card">
    <h1 style="text-align:center;font-size:42px;letter-spacing:3px">ALLO</h1>
    <p style="text-align:center;color:var(--muted);margin:12px 0 24px">
      Exp√©rience premium, rapide et ma√Ætris√©e
    </p>
    <button class="primary" style="width:100%" onclick="enterApp()">
      Entrer dans l‚Äôexp√©rience
    </button>
  </div>
</section>

<!-- =========================
     APP
========================= -->
<div id="app-shell" style="display:none">

  <!-- NAV -->
  <div class="card">
    <div class="stack">
      <button class="secondary" onclick="go('dashboard')">üè† Accueil</button>
      <button class="secondary" onclick="go('cart')">üõí Panier</button>
      <button class="secondary" onclick="go('history')">üìú Historique</button>
    </div>
  </div>

  <!-- DASHBOARD -->
  <section id="dashboard" class="screen">
    <div class="card">
      <h2>Catalogue</h2>
      <div class="stack">
        <button class="primary" onclick="go('jaune')">üü° Jaune</button>
        <button class="secondary" onclick="go('filtrer')">üî• Filtrer</button>
        <button class="secondary" onclick="go('frozen')">‚ùÑÔ∏è Frozen</button>
      </div>
    </div>
  </section>

  <!-- PRODUITS -->
  <section id="jaune" class="screen"></section>
  <section id="filtrer" class="screen"></section>
  <section id="frozen" class="screen"></section>

  <!-- PANIER -->
  <section id="cart" class="screen">
    <div class="card">
      <h2>üõí Panier</h2>
      <div id="cart-list"></div>
      <div class="stack">
        <button class="primary" onclick="openConfirm()">
          Confirmer la commande
        </button>
      </div>
    </div>
  </section>

  <!-- HISTORIQUE -->
  <section id="history" class="screen">
    <div class="card">
      <h2>üìú Historique</h2>
      <div id="history-list"></div>
    </div>
  </section>

  <!-- MODAL CONFIRMATION -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <h2>Confirmer la commande</h2>
      <div id="confirm-content" style="margin:12px 0"></div>

      <div class="stack">
        <button class="primary" onclick="sendOrderViaTelegram(this)">
          üì© Envoyer sur Telegram
        </button>
        <button class="secondary" onclick="closeModal()">
          Annuler
        </button>
      </div>
    </div>
  </div>

</div>
<script>
/* =====================================================
   NAVIGATION
===================================================== */
function go(id){
  document.querySelectorAll(".screen").forEach(function(s){
    s.classList.remove("active");
  });
  const el = document.getElementById(id);
  if(el){
    el.classList.add("active");
  }
  if(id === "cart"){ renderCart(); }
  if(id === "history"){ renderHistory(); }
}

function enterApp(){
  document.getElementById("landing").classList.remove("active");
  document.getElementById("app-shell").style.display = "block";
  go("dashboard");
}

/* =====================================================
   PRODUITS (IDENTIQUE)
===================================================== */
const PRODUCTS = {
  jaune: [
    { price: 10, qty: "2g" },
    { price: 20, qty: "4g" },
    { price: 50, qty: "10g" }
  ],
  filtrer: [
    { price: 20, qty: "2g" },
    { price: 70, qty: "10g" }
  ],
  frozen: [
    { price: 30, qty: "3g" },
    { price: 90, qty: "10g" }
  ]
};

/* =====================================================
   STATE
===================================================== */
let cart = JSON.parse(localStorage.getItem("cart") || "[]");
let orders = JSON.parse(localStorage.getItem("orders") || "[]");

/* =====================================================
   CATALOGUES
===================================================== */
function renderCatalogue(id, key, title){
  const el = document.getElementById(id);
  let html = `<div class="card"><h2>${title}</h2><div class="stack">`;

  PRODUCTS[key].forEach(function(p){
    html += `
      <div class="card soft">
        <strong>${p.qty}</strong> ‚Äî ${p.price}‚Ç¨
        <button class="secondary" style="margin-top:8px"
          onclick="addToCart('${key}','${p.qty}',${p.price})">
          Ajouter
        </button>
      </div>
    `;
  });

  html += `<button class="secondary" onclick="go('dashboard')">Retour</button>`;
  html += `</div></div>`;
  el.innerHTML = html;
}

renderCatalogue("jaune","jaune","üü° Jaune");
renderCatalogue("filtrer","filtrer","üî• Filtrer");
renderCatalogue("frozen","frozen","‚ùÑÔ∏è Frozen");

/* =====================================================
   PANIER
===================================================== */
function addToCart(range, qty, price){
  const found = cart.find(function(i){
    return i.range === range && i.qty === qty;
  });

  if(found){
    found.count += 1;
  }else{
    cart.push({
      range: range,
      qty: qty,
      price: price,
      count: 1
    });
  }

  localStorage.setItem("cart", JSON.stringify(cart));
}

function renderCart(){
  const box = document.getElementById("cart-list");

  if(cart.length === 0){
    box.innerHTML = "<p>Panier vide.</p>";
    return;
  }

  let html = "";
  cart.forEach(function(i, idx){
    html += `
      <div class="card soft">
        ${i.qty} (${i.range}) √ó ${i.count}<br>
        <strong>${i.price * i.count}‚Ç¨</strong><br>
        <button class="secondary" onclick="changeQty(${idx},-1)">‚àí</button>
        <button class="secondary" onclick="changeQty(${idx},1)">+</button>
      </div>
    `;
  });

  box.innerHTML = html;
}

function changeQty(index, delta){
  cart[index].count += delta;
  if(cart[index].count <= 0){
    cart.splice(index,1);
  }
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

/* =====================================================
   CONFIRMATION
===================================================== */
function openConfirm(){
  if(cart.length === 0){ return; }

  let html = "";
  cart.forEach(function(i){
    html += `${i.qty} √ó ${i.count} ‚Äî ${i.price * i.count}‚Ç¨<br>`;
  });

  document.getElementById("confirm-content").innerHTML = html;
  document.getElementById("modal").classList.add("active");
}

function closeModal(){
  document.getElementById("modal").classList.remove("active");
}

/* =====================================================
   ENVOI TELEGRAM (LOGIQUE SIMPLE ET PROPRE)
===================================================== */
function sendOrderViaTelegram(button){
  if(cart.length === 0){
    alert("Aucune commande √† envoyer.");
    return;
  }

  const total = cart.reduce(function(sum,i){
    return sum + i.price * i.count;
  }, 0);

  let text = "üßæ COMMANDE ALLO\n\n";
  cart.forEach(function(i){
    text += `‚Ä¢ ${i.qty} (${i.range}) √ó ${i.count} ‚Äî ${i.price * i.count}‚Ç¨\n`;
  });
  text += `\nüí∞ Total : ${total}‚Ç¨`;
  text += `\n‚è∞ ${new Date().toLocaleString()}`;

  const USERNAME = "allo856"; // sans @
  const url =
    "https://t.me/" + USERNAME + "?text=" + encodeURIComponent(text);

  window.location.href = url;
}

/* =====================================================
   HISTORIQUE (LOCAL)
===================================================== */
function renderHistory(){
  const box = document.getElementById("history-list");
  if(orders.length === 0){
    box.innerHTML = "<p>Aucune commande.</p>";
    return;
  }

  let html = "";
  orders.forEach(function(o){
    html += `<div class="card soft">${o}</div>`;
  });

  box.innerHTML = html;
}
</script>
<script>
/* =====================================================
   FEEDBACK VISUEL MINIMAL (AJOUT PROPRE)
===================================================== */

/* =====================================================
   APPLIQUER UN √âTAT DE CHARGEMENT AU BOUTON
===================================================== */
function setLoading(button){
  if(!button) return;
  button.classList.add("loading");
}

/* =====================================================
   APPLIQUER UN √âTAT DE SUCC√àS AU BOUTON
===================================================== */
function setSuccess(button){
  if(!button) return;
  button.classList.remove("loading");
  button.classList.add("success");
}

/* =====================================================
   R√âINITIALISER LE BOUTON
===================================================== */
function resetButton(button){
  if(!button) return;
  button.classList.remove("loading");
  button.classList.remove("success");
}

/* =====================================================
   SURCHARGE PROPRE DE L‚ÄôENVOI TELEGRAM
   (M√äME LOGIQUE, + FEEDBACK)
===================================================== */
const originalSendOrderViaTelegram = sendOrderViaTelegram;

sendOrderViaTelegram = function(button){
  if(!cart.length){
    alert("Aucune commande √† envoyer.");
    return;
  }

  setLoading(button);

  setTimeout(function(){
    setSuccess(button);
    originalSendOrderViaTelegram(button);
  }, 300);
};
</script>
<script>
/* =====================================================
   GARDE-FOUS GLOBAL
===================================================== */
window.addEventListener("error", function(event){
  console.error("ALLO ERROR:", event.message);
});
</script>

</body>
</html>
