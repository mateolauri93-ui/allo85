<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>ALLO85 ‚Äì Mini App Telegram</title>

<style>
:root{
--bg:#0e1117;
--card:#161b22;
--accent:#1f6feb;
--success:#2ea043;
--error:#f85149;
--text:#e6edf3;
--muted:#8b949e;
--radius:14px;
--speed:.35s;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto}
body{background:linear-gradient(180deg,#0e1117,#0b0f14);color:var(--text)}
.app{max-width:520px;margin:auto;padding:20px}
.screen{display:none;animation:fade .35s ease}
.screen.active{display:block}
.card{background:var(--card);border-radius:var(--radius);padding:20px;margin-bottom:16px;box-shadow:0 10px 25px rgba(0,0,0,.35)}
h1{font-size:28px;text-align:center;margin-bottom:6px}
h2{font-size:18px;margin-bottom:12px}
p{font-size:14px;color:var(--muted);line-height:1.4}
button{border:none;border-radius:var(--radius);padding:14px;font-size:15px;font-weight:600;cursor:pointer;transition:.25s}
button.primary{background:linear-gradient(135deg,#1f6feb,#3b82f6);color:#fff}
button.secondary{background:#21262d;color:#fff}
button.danger{background:#21262d;color:var(--error)}
button:active{transform:scale(.97)}
button:disabled{opacity:.5;cursor:not-allowed}
.actions{display:flex;flex-direction:column;gap:12px}
input,textarea,select{
width:100%;background:#0d1117;border:1px solid #30363d;
border-radius:10px;padding:12px;color:#fff;font-size:14px
}
nav{display:flex;justify-content:space-between;margin-top:16px}
.badge{font-size:12px;padding:4px 8px;border-radius:20px;background:#21262d;color:var(--muted)}
.status{text-align:center;margin-top:12px;font-size:14px}
.success{color:var(--success)}
.error{color:var(--error)}

@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1}}
</style>
</head>

<body>
<div class="app">

<!-- SPLASH -->
<section id="splash" class="screen active">
  <div class="card">
    <h1>ALLO85</h1>
    <p style="text-align:center">Mini-application Telegram professionnelle</p>
    <div class="actions" style="margin-top:20px">
      <button class="primary" onclick="go('home')">Entrer</button>
    </div>
  </div>
</section>

<!-- HOME -->
<section id="home" class="screen">
  <div class="card">
    <h2>Dashboard</h2>
    <p>Choisis une action √† effectuer.</p>
    <div class="actions">
      <button class="primary" onclick="selectAction('Demande urgente')">üö® Demande urgente</button>
      <button class="primary" onclick="selectAction('Commande standard')">üì¶ Commande standard</button>
      <button class="primary" onclick="selectAction('Information')">‚ÑπÔ∏è Information</button>
      <button class="secondary" onclick="go('history')">üìú Historique</button>
      <button class="secondary" onclick="go('about')">√Ä propos</button>
    </div>
  </div>
</section>

<!-- FORM -->
<section id="form" class="screen">
  <div class="card">
    <h2 id="formTitle"></h2>
    <p>Compl√®te les informations ci-dessous.</p>

    <input id="name" placeholder="Ton nom">
    <textarea id="message" placeholder="Message / D√©tails" rows="4" style="margin-top:10px"></textarea>

    <div class="actions" style="margin-top:16px">
      <button class="primary" onclick="confirm()">Continuer</button>
      <button class="secondary" onclick="go('home')">Annuler</button>
    </div>
  </div>
</section>

<!-- CONFIRM -->
<section id="confirm" class="screen">
  <div class="card">
    <h2>Confirmation</h2>
    <p>V√©rifie avant envoi.</p>
    <div class="badge" id="confirmData"></div>

    <div class="actions" style="margin-top:16px">
      <button class="primary" onclick="send()">Envoyer</button>
      <button class="secondary" onclick="go('form')">Modifier</button>
    </div>
  </div>
</section>

<!-- RESULT -->
<section id="result" class="screen">
  <div class="card">
    <h2 id="resultTitle"></h2>
    <p id="resultMsg"></p>
    <div class="actions" style="margin-top:16px">
      <button class="primary" onclick="go('home')">Retour accueil</button>
    </div>
  </div>
</section>

<!-- HISTORY -->
<section id="history" class="screen">
  <div class="card">
    <h2>Historique</h2>
    <div id="historyList"></div>
    <div class="actions" style="margin-top:16px">
      <button class="secondary" onclick="go('home')">Retour</button>
    </div>
  </div>
</section>

<!-- ABOUT -->
<section id="about" class="screen">
  <div class="card">
    <h2>√Ä propos</h2>
    <p>
      ALLO85 est une mini-app Telegram autonome, rapide et s√©curis√©e.
      Toutes les actions sont enregistr√©es localement et envoy√©es via Telegram WebApp.
    </p>
    <div class="actions" style="margin-top:16px">
      <button class="secondary" onclick="go('home')">Retour</button>
    </div>
  </div>
</section>

</div>

<script>
const tg = window.Telegram ? window.Telegram.WebApp : null;
if(tg){tg.ready();tg.expand();}

let state={action:null,name:"",message:""};

function go(id){
document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
document.getElementById(id).classList.add('active');
if(id==="history") renderHistory();
}

function selectAction(a){
state.action=a;
document.getElementById('formTitle').innerText=a;
go('form');
}

function confirm(){
state.name=document.getElementById('name').value;
state.message=document.getElementById('message').value;
document.getElementById('confirmData').innerText=
`Action: ${state.action}\nNom: ${state.name}\nMessage: ${state.message}`;
go('confirm');
}

function send(){
const payload={
app:"ALLO85",
action:state.action,
name:state.name,
message:state.message,
time:Date.now()
};

try{
if(tg) tg.sendData(JSON.stringify(payload));
saveHistory(payload);
showResult(true);
}catch(e){showResult(false);}
}

function showResult(ok){
document.getElementById('resultTitle').innerText=ok?"Succ√®s":"Erreur";
document.getElementById('resultMsg').innerText=
ok?"Action envoy√©e avec succ√®s.":"Impossible d‚Äôenvoyer.";
go('result');
}

function saveHistory(data){
let h=JSON.parse(localStorage.getItem('allo85_history')||"[]");
h.unshift(data);
localStorage.setItem('allo85_history',JSON.stringify(h));
}

function renderHistory(){
let h=JSON.parse(localStorage.getItem('allo85_history')||"[]");
const box=document.getElementById('historyList');
box.innerHTML=h.length?"":
"<p>Aucune action enregistr√©e.</p>";
h.forEach(e=>{
const d=document.createElement('div');
d.className="badge";
d.style.marginBottom="8px";
d.innerText=`${new Date(e.time).toLocaleString()} ‚Äì ${e.action}`;
box.appendChild(d);
});
}
</script>
</body>
</html>
