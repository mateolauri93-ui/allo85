<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>ALLO â€“ Premium Telegram App</title>

<style>
/* =========================
   THEME & VARIABLES
========================= */
:root{
  --bg:#0b0f14;
  --bg-soft:#0f141c;
  --card:#161b22;
  --card-soft:#1c222b;
  --accent:#c9a24d;
  --accent-2:#3b82f6;
  --green:#2ea043;
  --yellow:#facc15;
  --orange:#fb923c;
  --blue:#60a5fa;
  --muted:#8b949e;
  --text:#e6edf3;
  --radius:18px;
  --radius-sm:12px;
  --shadow:0 12px 35px rgba(0,0,0,.45);
  --speed:.3s;
}

/* =========================
   RESET
========================= */
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
}

body{
  background:linear-gradient(180deg,#0b0f14,#0a0d12);
  color:var(--text);
  min-height:100vh;
}

/* =========================
   APP LAYOUT
========================= */
.app{
  max-width:540px;
  margin:auto;
  padding:18px 14px 40px;
}

header{
  text-align:center;
  margin-bottom:22px;
}

header h1{
  font-size:32px;
  letter-spacing:1px;
}

header p{
  font-size:14px;
  color:var(--muted);
}

/* =========================
   NAV BAR
========================= */
.nav{
  display:flex;
  justify-content:space-between;
  gap:8px;
  margin-bottom:18px;
}

.nav button{
  flex:1;
  padding:12px;
  border-radius:14px;
  border:none;
  background:#21262d;
  color:var(--text);
  font-size:14px;
  cursor:pointer;
}

/* =========================
   SCREENS
========================= */
.screen{
  display:none;
  animation:fade .3s ease;
}
.screen.active{display:block}

@keyframes fade{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1}
}

/* =========================
   CARDS
========================= */
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:20px;
  margin-bottom:16px;
  box-shadow:var(--shadow);
}

.card.soft{background:var(--card-soft)}

.card h2{
  font-size:20px;
  margin-bottom:10px;
}

.card p{
  font-size:14px;
  color:var(--muted);
  line-height:1.4;
}

/* =========================
   BUTTONS
========================= */
button{
  border:none;
  border-radius:14px;
  padding:14px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  transition:transform .15s,opacity .15s;
}
button:active{transform:scale(.97)}
button:disabled{opacity:.5}

.primary{background:linear-gradient(135deg,var(--accent),#f5d57a);color:#000}
.secondary{background:#21262d;color:var(--text)}

.jaune{background:var(--yellow);color:#000}
.filtrer{background:var(--orange);color:#000}
.frozen{background:var(--blue);color:#000}

/* =========================
   STACKS
========================= */
.stack{
  display:flex;
  flex-direction:column;
  gap:12px;
  margin-top:14px;
}

/* =========================
   LIST ITEMS
========================= */
.item{
  background:#0d1117;
  border-radius:12px;
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}

.item span{font-size:14px}

/* =========================
   BADGES
========================= */
.badge{
  font-size:12px;
  padding:5px 10px;
  border-radius:20px;
  background:#21262d;
  color:var(--muted);
}

/* =========================
   PROGRESS
========================= */
.progress{
  background:#21262d;
  border-radius:20px;
  height:10px;
  overflow:hidden;
  margin-top:8px;
}
.progress span{
  display:block;
  height:100%;
  background:linear-gradient(90deg,var(--accent),#f5d57a);
  width:0%;
}

/* =========================
   FOOTER
========================= */
.footer{
  text-align:center;
  font-size:12px;
  color:var(--muted);
  margin-top:26px;
}
</style>
</head>

<body>
<div class="app">

<header>
  <h1>ALLO</h1>
  <p>ExpÃ©rience premium â€¢ rapide â€¢ maÃ®trisÃ©e</p>
</header>

<div class="nav">
  <button onclick="go('home')">ğŸ </button>
  <button onclick="go('fidelite')">â­</button>
  <button onclick="go('club')">ğŸ†</button>
  <button onclick="go('history')">ğŸ“œ</button>
</div>

<!-- HOME -->
<section id="home" class="screen active">
  <div class="card">
    <h2>Accueil</h2>
    <p>Choisis ton univers.</p>
    <div class="stack">
      <button class="primary" onclick="go('cat-choco')">ğŸ« CatÃ©gorie ğŸ«</button>
      <button class="secondary" onclick="go('cat-green')">ğŸ¥¦ CatÃ©gorie ğŸ¥¦</button>
    </div>
  </div>
</section>

<!-- ğŸ« -->
<section id="cat-choco" class="screen">
  <div class="card">
    <h2>ğŸ« SÃ©lection</h2>
    <div class="stack">
      <button class="jaune" onclick="go('jaune')">ğŸŸ¡ Jaune â€“ Standard</button>
      <button class="filtrer" onclick="go('filtrer')">ğŸ”¥ Filtrer â€“ Premium</button>
      <button class="frozen" onclick="go('frozen')">â„ï¸ Frozen â€“ Ultra</button>
      <button class="secondary" onclick="go('home')">Retour</button>
    </div>
  </div>
</section>

<!-- ğŸ¥¦ -->
<section id="cat-green" class="screen">
  <div class="card">
    <h2>ğŸ¥¦ Origine</h2>
    <div class="stack">
      <button class="primary" onclick="go('spain')">ğŸ‡ªğŸ‡¸ Cali Espagne</button>
      <button class="secondary" onclick="go('usa')">ğŸ‡ºğŸ‡¸ Cali USA</button>
      <button class="secondary" onclick="go('home')">Retour</button>
    </div>
  </div>
</section>

<!-- PRICES PLACEHOLDER SCREENS -->
<section id="jaune" class="screen"></section>
<section id="filtrer" class="screen"></section>
<section id="frozen" class="screen"></section>
<section id="spain" class="screen"></section>
<section id="usa" class="screen"></section>

<!-- FIDELITE -->
<section id="fidelite" class="screen">
  <div class="card">
    <h2>â­ FidÃ©litÃ©</h2>
    <p>1â‚¬ = 1 point</p>
    <div class="progress"><span id="progress-bar"></span></div>
    <div class="badge" id="points">0 points</div>
  </div>
</section>

<!-- CLUB -->
<section id="club" class="screen">
  <div class="card soft">
    <h2>ğŸ† Club Avantages</h2>
    <p>Espace premium rÃ©servÃ©.</p>
    <div class="badge">AccÃ¨s contrÃ´lÃ©</div>
  </div>
</section>

<!-- HISTORY -->
<section id="history" class="screen">
  <div class="card">
    <h2>ğŸ“œ Historique</h2>
    <div id="history-list"></div>
  </div>
</section>

<div class="footer">
  Â© ALLO â€“ Telegram App
</div>

</div>
<script>
/* =========================
   TELEGRAM
========================= */
const TG = window.Telegram ? window.Telegram.WebApp : null;
if (TG) {
  TG.ready();
  TG.expand();
}

/* =========================
   ROUTER
========================= */
function go(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  const el = document.getElementById(id);
  if (el) el.classList.add("active");
  if (id === "fidelite") updateFidelite();
  if (id === "history") renderHistory();
}

/* =========================
   DATA PRODUITS
========================= */
const PRODUCTS = {
  jaune: [
    [10,"2g"],[20,"4g"],[50,"10g"],[90,"20g"],[200,"50g"],[320,"100g"]
  ],
  filtrer: [
    [10,"1,35g"],[20,"2,7g"],[70,"10g"],[130,"20g"],[350,"50g"],[650,"100g"]
  ],
  frozen: [
    [20,"1,4g"],[70,"5g"],[130,"10g"],[300,"25g"],[550,"50g"],[900,"100g"]
  ],
  spain: [
    [10,"1,25g"],[20,"2,5g"],[80,"10g"],[150,"20g"],[380,"50g"],[700,"100g"]
  ]
};

/* =========================
   STATE
========================= */
let state = {
  category:null,
  range:null,
  price:0,
  qty:"",
  points: Number(localStorage.getItem("points") || 0),
  history: JSON.parse(localStorage.getItem("history") || "[]")
};

/* =========================
   RENDER LISTS
========================= */
function renderList(id, key, title) {
  const screen = document.getElementById(id);
  screen.innerHTML = `
    <div class="card">
      <h2>${title}</h2>
      <div class="stack">
        ${PRODUCTS[key].map(p=>`
          <div class="item" onclick="select('${key}',${p[0]},'${p[1]}')">
            <span>${p[1]}</span>
            <strong>${p[0]} â‚¬</strong>
          </div>`).join("")}
        <button class="secondary" onclick="go('cat-${key==='spain'?'green':'choco'}')">Retour</button>
      </div>
    </div>`;
}

/* =========================
   INIT LISTS
========================= */
renderList("jaune","jaune","ğŸŸ¡ Jaune â€“ Standard");
renderList("filtrer","filtrer","ğŸ”¥ Filtrer â€“ Premium");
renderList("frozen","frozen","â„ï¸ Frozen â€“ Ultra Premium");
renderList("spain","spain","ğŸ‡ªğŸ‡¸ Cali Espagne â€“ Gorilla Glue");

document.getElementById("usa").innerHTML = `
  <div class="card soft">
    <h2>ğŸ‡ºğŸ‡¸ Cali USA</h2>
    <p>Coming soon</p>
    <button class="secondary" onclick="go('cat-green')">Retour</button>
  </div>`;

/* =========================
   SELECT & CONFIRM
========================= */
function select(range, price, qty) {
  state.range = range;
  state.price = price;
  state.qty = qty;

  const payload = {
    app:"ALLO",
    range,
    price,
    qty,
    points: price,
    date: new Date().toLocaleString()
  };

  if (TG) {
    TG.sendData(JSON.stringify(payload));
  }

  state.points += price;
  state.history.unshift(payload);

  localStorage.setItem("points", state.points);
  localStorage.setItem("history", JSON.stringify(state.history));

  alert(`Commande envoyÃ©e âœ…\n${qty} â€“ ${price}â‚¬`);
  go("home");
}

/* =========================
   FIDELITE
========================= */
function updateFidelite() {
  document.getElementById("points").innerText = `${state.points} points`;
  const paliers = [90,130,170,250,350];
  const next = paliers.find(p=>p>state.points) || paliers[paliers.length-1];
  const percent = Math.min(100, (state.points/next)*100);
  document.getElementById("progress-bar").style.width = percent+"%";
}

/* =========================
   HISTORY
========================= */
function renderHistory() {
  const box = document.getElementById("history-list");
  if (!state.history.length) {
    box.innerHTML = "<p>Aucune commande.</p>";
    return;
  }
  box.innerHTML = state.history.map(h=>`
    <div class="item">
      <span>${h.qty} â€“ ${h.range}</span>
      <strong>${h.price}â‚¬</strong>
    </div>`).join("");
}
</script>
</body>
</html>
