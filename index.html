<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>ALLO ‚Äî Premium Experience</title>

<style>
/* =====================================================
   THEME GLOBAL ‚Äî FINAL
===================================================== */
:root{
  --bg-main:#0b0f14;
  --bg-dark:#07090d;
  --card:#161b22;
  --card-soft:#1c222b;

  --gold:#c9a24d;
  --gold-soft:#f5d57a;

  --yellow:#facc15;
  --orange:#fb923c;
  --blue:#60a5fa;
  --green:#2ea043;

  --text:#e6edf3;
  --muted:#8b949e;

  --radius:18px;
  --radius-sm:12px;
  --shadow:0 14px 40px rgba(0,0,0,.45);
  --speed:.35s;
}

/* =====================================================
   RESET
===================================================== */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu;
  background:linear-gradient(180deg,var(--bg-main),var(--bg-dark));
  color:var(--text);
}

/* =====================================================
   APP WRAPPER
===================================================== */
.app{
  max-width:560px;
  margin:auto;
  min-height:100%;
  padding:14px 14px 44px;
  position:relative;
}

/* =====================================================
   SCREENS / ROUTER
===================================================== */
.screen{display:none;animation:fade var(--speed) ease}
.screen.active{display:block}
@keyframes fade{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:none}
}

/* =====================================================
   HEADER
===================================================== */
.header{
  text-align:center;
  padding:10px 0 14px;
}
.header h1{
  font-size:34px;
  letter-spacing:2px;
}
.header p{
  font-size:14px;
  color:var(--muted);
}

/* =====================================================
   NAV
===================================================== */
.nav{
  display:flex;
  gap:8px;
  margin-bottom:14px;
}
.nav button{
  flex:1;
  border:none;
  border-radius:14px;
  padding:12px;
  background:#21262d;
  color:var(--text);
  font-size:14px;
  cursor:pointer;
}

/* =====================================================
   CARDS / UI
===================================================== */
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:18px;
  margin-bottom:14px;
  box-shadow:var(--shadow);
}
.card.soft{background:var(--card-soft)}
.card h2{font-size:20px;margin-bottom:8px}
.card h3{font-size:16px;margin-bottom:6px}
.card p{font-size:14px;color:var(--muted);line-height:1.45}

/* =====================================================
   BUTTONS
===================================================== */
button{
  border:none;border-radius:14px;
  padding:14px;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  transition:transform .15s,opacity .15s;
}
button:active{transform:scale(.97)}
button:disabled{opacity:.5}
.primary{
  background:linear-gradient(135deg,var(--gold),var(--gold-soft));
  color:#000;
}
.secondary{background:#21262d;color:var(--text)}
.jaune{background:var(--yellow);color:#000}
.filtrer{background:var(--orange);color:#000}
.frozen{background:var(--blue);color:#000}

/* =====================================================
   STACK / LIST
===================================================== */
.stack{display:flex;flex-direction:column;gap:12px;margin-top:12px}
.item{
  background:#0d1117;
  border-radius:12px;
  padding:12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

/* =====================================================
   BADGES / PROGRESS
===================================================== */
.badge{
  display:inline-block;
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  background:#21262d;
  color:var(--muted);
}
.progress{
  height:10px;
  border-radius:999px;
  background:#21262d;
  overflow:hidden;
  margin-top:8px;
}
.progress span{
  display:block;height:100%;width:0%;
  background:linear-gradient(90deg,var(--gold),var(--gold-soft));
}

/* =====================================================
   MODAL
===================================================== */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;align-items:center;justify-content:center;
  z-index:50;
}
.modal.active{display:flex}
.modal-content{
  width:92%;max-width:420px;
  background:var(--card);
  border-radius:var(--radius);
  padding:18px;
  box-shadow:var(--shadow);
}

/* =====================================================
   LANDING ‚Äî HERO
===================================================== */
.landing-hero{
  position:relative;
  min-height:100vh;
  background:linear-gradient(180deg,#0b0f14,#07090d);
}
.hero-content{
  position:relative;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:24px;
}
.hero-content h1{font-size:48px;letter-spacing:3px}
.hero-content p{color:var(--muted);margin:10px 0 28px}

/* =====================================================
   FOOTER
===================================================== */
.footer{
  text-align:center;
  font-size:12px;
  color:var(--muted);
  margin-top:24px;
}
</style>

</head>

<body>
<div class="app">

<!-- =========================
     LANDING (PAGE D‚ÄôACCUEIL)
========================= -->
<section id="landing" class="screen active">
  <div class="landing-hero">
    <div class="hero-content">
      <h1>ALLO</h1>
      <p>Exp√©rience premium, rapide et ma√Ætris√©e</p>
      <button class="primary" onclick="enterApp()">Entrer dans l‚Äôexp√©rience</button>
    </div>
  </div>
</section>

<!-- =========================
     HEADER + NAV (APP)
========================= -->
<div id="app-shell" style="display:none">
  <div class="header">
    <h1>ALLO</h1>
    <p>Premium ‚Ä¢ rapide ‚Ä¢ ma√Ætris√©</p>
  </div>

  <div class="nav">
    <button onclick="go('dashboard')">üè†</button>
    <button onclick="go('cart')">üõí</button>
    <button onclick="go('fidelite')">‚≠ê</button>
    <button onclick="go('club')">üèÜ</button>
    <button onclick="go('history')">üìú</button>
  </div>

  <!-- =========================
       DASHBOARD
  ========================= -->
  <section id="dashboard" class="screen">
    <div class="card">
      <h2>Dashboard</h2>
      <p>Choisis ton univers.</p>
      <div class="stack">
        <button class="primary" onclick="go('cat-choco')">üç´ Cat√©gorie üç´</button>
        <button class="secondary" onclick="go('cat-green')">ü•¶ Cat√©gorie ü•¶</button>
      </div>
    </div>

    <div class="card soft">
      <h3>‚≠ê Fid√©lit√©</h3>
      <div class="badge" id="points-mini">0 pts</div>
      <div class="progress"><span id="progress-mini"></span></div>
    </div>

    <div class="card soft">
      <h3>üèÜ Club Avantages</h3>
      <p class="muted">Statut : <strong>Non membre</strong></p>
    </div>
  </section>

  <!-- =========================
       CATEGORIES
  ========================= -->
  <section id="cat-choco" class="screen">
    <div class="card">
      <h2>üç´ S√©lection</h2>
      <div class="stack">
        <button class="jaune" onclick="go('jaune')">üü° Jaune ‚Äî Standard</button>
        <button class="filtrer" onclick="go('filtrer')">üî• Filtrer ‚Äî Premium</button>
        <button class="frozen" onclick="go('frozen')">‚ùÑÔ∏è Frozen ‚Äî Ultra</button>
        <button class="secondary" onclick="go('dashboard')">Retour</button>
      </div>
    </div>
  </section>

  <section id="cat-green" class="screen">
    <div class="card">
      <h2>ü•¶ Origine</h2>
      <div class="stack">
        <button class="primary" onclick="go('spain')">üá™üá∏ Cali Espagne</button>
        <button class="secondary" onclick="go('usa')">üá∫üá∏ Cali USA</button>
        <button class="secondary" onclick="go('dashboard')">Retour</button>
      </div>
    </div>
  </section>

  <section id="jaune" class="screen"></section>
  <section id="filtrer" class="screen"></section>
  <section id="frozen" class="screen"></section>
  <section id="spain" class="screen"></section>
  <section id="usa" class="screen"></section>

  <!-- =========================
       CART
  ========================= -->
  <section id="cart" class="screen">
    <div class="card">
      <h2>üõí Panier</h2>
      <div id="cart-list"></div>
      <div class="stack">
        <button class="primary" onclick="openConfirm()">Confirmer</button>
      </div>
    </div>
  </section>

  <section id="fidelite" class="screen">
    <div class="card">
      <h2>‚≠ê Fid√©lit√©</h2>
      <div class="badge" id="points">0 points</div>
      <div class="progress"><span id="progress-bar"></span></div>
    </div>
  </section>

  <section id="club" class="screen">
    <div class="card soft">
      <h2>üèÜ Club Avantages</h2>
      <p>Espace premium r√©serv√©.</p>
      <div class="badge">Non membre</div>
    </div>
  </section>

  <section id="history" class="screen">
    <div class="card">
      <h2>üìú Historique</h2>
      <div id="history-list"></div>
    </div>
  </section>

  <!-- =========================
       MODAL CONFIRMATION (MODIFI√â)
  ========================= -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <h2>Confirmer la commande</h2>
      <div id="confirm-content"></div>

      <div class="stack">
        <button class="primary" onclick="copyOrderToClipboard()">
          üìã Copier la commande
        </button>

        <button class="secondary" onclick="sendOrderViaTelegram()">
          üì© Envoyer sur Telegram
        </button>

        <button class="secondary" onclick="closeModal()">
          Annuler
        </button>
      </div>
    </div>
  </div>

  <div class="footer">¬© ALLO ‚Äî Telegram App</div>
</div>

<script>
/* =====================================================
   ROUTER
===================================================== */
function go(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id)?.classList.add("active");
  if(id==="cart") renderCart();
  if(id==="fidelite") updateFidelite();
  if(id==="history") renderHistory();
}

function enterApp(){
  document.getElementById("landing").classList.remove("active");
  document.getElementById("app-shell").style.display="block";
  go("dashboard");
}

/* =====================================================
   DATA PRODUITS
===================================================== */
const PRODUCTS = {
  jaune:[[10,"2g"],[20,"4g"],[50,"10g"],[90,"20g"],[200,"50g"],[320,"100g"]],
  filtrer:[[10,"1,35g"],[20,"2,7g"],[70,"10g"],[130,"20g"],[350,"50g"],[650,"100g"]],
  frozen:[[20,"1,4g"],[70,"5g"],[130,"10g"],[300,"25g"],[550,"50g"],[900,"100g"]],
  spain:[[10,"1,25g"],[20,"2,5g"],[80,"10g"],[150,"20g"],[380,"50g"],[700,"100g"]]
};

/* =====================================================
   STATE
===================================================== */
let cart = JSON.parse(localStorage.getItem("cart") || "[]");
let orders = JSON.parse(localStorage.getItem("orders") || "[]");
let pointsValid = Number(localStorage.getItem("pointsValid") || 0);
let pointsPending = Number(localStorage.getItem("pointsPending") || 0);

/* =====================================================
   CATALOGUES
===================================================== */
function renderCatalogue(id,key,title){
  const el = document.getElementById(id);
  el.innerHTML = `
    <div class="card">
      <h2>${title}</h2>
      <div class="stack">
        ${PRODUCTS[key].map(p=>`
          <div class="item">
            <span>${p[1]}</span>
            <strong>${p[0]}‚Ç¨</strong>
            <button class="secondary" onclick="addToCart('${key}',${p[0]},'${p[1]}')">+</button>
          </div>
        `).join("")}
        <button class="secondary" onclick="go('${key==="spain"?"cat-green":"cat-choco"}')">Retour</button>
      </div>
    </div>`;
}

renderCatalogue("jaune","jaune","üü° Jaune ‚Äî Standard");
renderCatalogue("filtrer","filtrer","üî• Filtrer ‚Äî Premium");
renderCatalogue("frozen","frozen","‚ùÑÔ∏è Frozen ‚Äî Ultra");
renderCatalogue("spain","spain","üá™üá∏ Cali Espagne");

document.getElementById("usa").innerHTML = `
  <div class="card soft">
    <h2>üá∫üá∏ Cali USA</h2>
    <p>Coming soon</p>
    <button class="secondary" onclick="go('cat-green')">Retour</button>
  </div>`;

/* =====================================================
   PANIER
===================================================== */
function addToCart(range, price, qty){
  const found = cart.find(i => i.range === range && i.qty === qty);
  found ? found.count++ : cart.push({ range, price, qty, count: 1 });
  localStorage.setItem("cart", JSON.stringify(cart));
}

function renderCart(){
  const box = document.getElementById("cart-list");
  if(!cart.length){
    box.innerHTML = "<p>Panier vide.</p>";
    return;
  }

  box.innerHTML = cart.map((i,idx)=>`
    <div class="item">
      <span>${i.qty} (${i.range})</span>
      <strong>${i.price * i.count}‚Ç¨</strong>
      <div>
        <button onclick="changeQty(${idx},-1)">‚àí</button>
        <button onclick="changeQty(${idx},1)">+</button>
      </div>
    </div>
  `).join("");
}

function changeQty(i,d){
  cart[i].count += d;
  if(cart[i].count <= 0) cart.splice(i,1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

/* =====================================================
   CONFIRMATION
===================================================== */
function openConfirm(){
  if(!cart.length) return;

  document.getElementById("modal").classList.add("active");
  document.getElementById("confirm-content").innerHTML =
    cart.map(i => `${i.qty} x${i.count} ‚Äî ${i.price * i.count}‚Ç¨`).join("<br>");
}

function closeModal(){
  document.getElementById("modal").classList.remove("active");
}

/* =====================================================
   NOUVELLES FONCTIONS ‚Äî ENVOI SIMPLE
===================================================== */
function generateOrderText(){
  if(!cart.length) return "";

  const total = cart.reduce((s,i)=>s + (i.price * i.count), 0);

  let text = "üßæ COMMANDE ALLO\n\n";
  cart.forEach(i=>{
    text += `‚Ä¢ ${i.qty} (${i.range}) x${i.count} ‚Äî ${i.price * i.count}‚Ç¨\n`;
  });

  text += `\nüí∞ Total : ${total}‚Ç¨`;
  text += `\n‚è∞ ${new Date().toLocaleString()}`;

  return text;
}

function copyOrderToClipboard(){
  const text = generateOrderText();
  if(!text){
    alert("Aucune commande √† copier.");
    return;
  }

  navigator.clipboard.writeText(text)
    .then(()=> alert("Commande copi√©e üìã\nColle-la dans Telegram"))
    .catch(()=> alert("Erreur lors de la copie."));
}

function sendOrderViaTelegram(){
  const text = generateOrderText();
  if(!text){
    alert("Aucune commande √† envoyer.");
    return;
  }

  const USERNAME = "allo856"; // ‚Üê TON @username SANS LE @

  const url =
    "https://t.me/" + USERNAME + "?text=" + encodeURIComponent(text);

  window.location.href = url;
}

/* =====================================================
   FIDELITE / HISTORIQUE (INCHANG√â)
===================================================== */
function updateFidelite(){
  document.getElementById("points").innerText =
    `${pointsValid} valid√©s ‚Ä¢ ${pointsPending} en attente`;
  document.getElementById("points-mini").innerText =
    `${pointsValid} pts`;

  const paliers = [90,130,170,250,350];
  const next = paliers.find(p=>p>pointsValid) || paliers[paliers.length-1];
  const pct = Math.min(100,(pointsValid/next)*100)+"%";

  document.getElementById("progress-bar").style.width = pct;
  document.getElementById("progress-mini").style.width = pct;
}

function renderHistory(){
  const box = document.getElementById("history-list");
  if(!orders.length){
    box.innerHTML = "<p>Aucune commande.</p>";
    return;
  }

  box.innerHTML = orders.map(o=>`
    <div class="item">
      <span>${o.date || ""}</span>
      <strong>${o.total || ""}‚Ç¨</strong>
      <span>${o.status || ""}</span>
    </div>
  `).join("");
}

updateFidelite();
</script>

<script>
/* =====================================================
   VALIDATION MANUELLE (LOCALE)
   - conserv√©e pour ton historique interne
   - aucune d√©pendance externe
===================================================== */

function refreshOrders(){
  if(!orders.length){
    alert("Aucune commande en attente.");
    return;
  }

  const pending = orders.find(o=>o.status==="‚è≥ En attente");
  if(!pending){
    alert("Aucune commande √† valider.");
    return;
  }

  pending.status = "‚úÖ Valid√©e";

  pointsValid += pending.total || 0;
  pointsPending -= pending.total || 0;
  if(pointsPending < 0) pointsPending = 0;

  localStorage.setItem("orders", JSON.stringify(orders));
  localStorage.setItem("pointsValid", pointsValid);
  localStorage.setItem("pointsPending", pointsPending);

  updateFidelite();
  renderHistory();

  showValidationModal(pending);
}

function showValidationModal(order){
  const modal = document.createElement("div");
  modal.className = "modal active";
  modal.innerHTML = `
    <div class="modal-content">
      <h2>Commande valid√©e</h2>
      <p><strong>${order.total || ""} points</strong> ont √©t√© ajout√©s.</p>
      <p>ID : ${order.id || ""}</p>
      <div class="stack">
        <button class="primary" onclick="this.closest('.modal').remove()">OK</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
}

/* =====================================================
   AJOUT BOUTON ACTUALISER (HISTORIQUE)
===================================================== */
(function addRefreshButton(){
  const history = document.getElementById("history");
  if(!history) return;

  const btn = document.createElement("button");
  btn.className = "secondary";
  btn.style.marginTop = "12px";
  btn.innerText = "üîÑ Actualiser mes commandes";
  btn.onclick = refreshOrders;

  history.querySelector(".card").appendChild(btn);
})();

/* =====================================================
   GARDE-FOUS
===================================================== */
window.addEventListener("error", e=>{
  console.error("ALLO ERROR:", e.message);
});
</script>

</body>
</html>
